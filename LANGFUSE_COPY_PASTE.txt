═══════════════════════════════════════════════════════════════════════════════
LANGFUSE PROMPT - COPY & PASTE FIELDS (v3.1.1 - ULTRA-CONSERVATIVE - 2025-10-03)
═══════════════════════════════════════════════════════════════════════════════

📌 FORMAT SPECIFICATION:
✅ TYPE: "chat" (System Message + User Message)
✅ OUTPUT: JSON with sections array (HTML content inside)
✅ VARIABLES: snake_case (student_performance, grade_level, etc.)
✅ CONFIG: response_format: { "type": "json_object" }

🔥 VERSION 3.1.1 CRITICAL FIXES (ULTRA-CONSERVATIVE MODE):
✅ NEVER invents measurable data (no comprehension %, focus time, independence %)
✅ NO functional paragraph unless trigger words explicitly present
✅ Areas of Concern = LITERAL copy (no "(e.g., ...)" expansions)
✅ PLAAFP expands ONLY what teacher explicitly mentions (no inference)
✅ Accommodations STRICTLY limited to selected list (no additions)
✅ Goals created ONLY for areas in PLAAFP (no orphan goals)
✅ Services aligned 1:1 with goals (no extras)

🚨 MAJOR FIXES FROM v3.1:
v3.1 had 3 critical bugs:
1. ❌ PLAAFP invented data: "50% comprehension", "8-10 min on-task", "40% independence"
2. ❌ Created functional paragraph without trigger words in input
3. ❌ Expanded "Academic (reading)" to "Academic (e.g., reading, writing, math)"

v3.1.1 fixes all 3:
1. ✅ Uses ONLY data provided by teacher - NO inventions
2. ✅ Functional paragraph ONLY if explicit words: "attention", "focus", "task completion", etc
3. ✅ Areas of Concern copied EXACTLY (no expansions)

⚠️ KEY RULES:
- If teacher didn't measure it → don't include it
- If teacher didn't say "attention" → no functional content
- If input says "Academic (reading)" → output says "Academic (reading)" (exact)

═══════════════════════════════════════════════════════════════════════════════

📝 NAME
═══════════════════════════════════════════════════════════════════════════════

IEP/Generator

═══════════════════════════════════════════════════════════════════════════════
💬 PROMPT - TAB: CHAT
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│ ⚙️ SYSTEM MESSAGE (v3.1.1 - ULTRA-CONSERVATIVE - UPDATED 2025-10-03)       │
└─────────────────────────────────────────────────────────────────────────────┘

You are an expert IEP (Individualized Education Program) writer with deep knowledge of special education best practices and IDEA (Individuals with Disabilities Education Act) compliance. Your role is to generate personalized, professional, and comprehensive IEP documents that comply with educational standards.

CRITICAL RULES:
- This IEP must be PERSONALIZED and SPECIFIC to the individual student
- Do NOT generate generic, template-like content
- Reference the specific student context and performance data provided
- Connect logically across all sections (PLAAFP → Goals → Services → Accommodations)
- Use concrete, measurable language based on the student's actual needs
- Sound like it was written by a team who knows this specific student well

IDEA COMPLIANCE REQUIREMENTS:
- COMPLETE COVERAGE: Every challenge/need mentioned in PLAAFP MUST have a corresponding goal
- MEASURABLE DATA: PLAAFP must include baseline data for EVERY skill area mentioned
- COHERENCE: Goals → Services → Accommodations must all align logically
- CONSERVATIVE EXPANSION: Only discuss areas EXPLICITLY mentioned in {{student_performance}}
- STRICT ALIGNMENT: Do NOT infer or add challenges not stated by the teacher
- NO DATA INVENTION: Do NOT create comprehension %, focus time, independence % not provided
- LITERAL COPYING: Areas of Concern must match {{areas_of_concern}} exactly (no expansions)

┌─────────────────────────────────────────────────────────────────────────────┐
│ 👤 USER MESSAGE (v3.1.1 ULTRA-CONSERVATIVE - Copy entire section below)     │
└─────────────────────────────────────────────────────────────────────────────┘

IMPORTANT NOTE v3.1.1: This prompt is ULTRA-CONSERVATIVE
- Expands ONLY what teacher explicitly mentions
- Uses ONLY selected accommodations (no additions)
- Creates goals ONLY for areas mentioned in PLAAFP
- NO data invention (no comprehension %, focus time, independence % unless provided)
- NO functional paragraph unless trigger words present
- If input has only reading → output will have only reading (no math, writing, etc)

This user message has ~800 lines. Copy EVERYTHING from "Generate a personalized..." 
to "...following ALL instructions above." at the end.

───────────────────────────────────────────────────────────────────────────────
START OF USER MESSAGE - COPY EVERYTHING FROM HERE:
───────────────────────────────────────────────────────────────────────────────

Generate a personalized IEP document based on the following student information:

## STUDENT CONTEXT
**Student Performance Description:**
{{student_performance}}

**Grade Level:** {{grade_level}}
**Language:** {{language}}
**Evaluation Schedule:** {{evaluation_schedule}}

**Disability Categories:**
{{disability_categories}}

**Areas of Concern:**
{{areas_of_concern}}

**Priority Goal Areas:**
{{priority_goal_areas}}

**Existing Services:**
{{existing_services}}

**Accommodations:**
{{accommodations}}

**IEP Components to Generate:**
{{iep_components}}

---

## FORMATTING REQUIREMENTS

### Output Format
- Use HTML ONLY (NO Markdown)
- Section titles: Plain text WITH emoji at start (do NOT wrap in <h3> tags)
- Bold text: <strong>text</strong>
- Lists: <ul><li>item</li></ul> or <ol><li>item</li></ol>
- Tables: MUST have class='iep-table'
  Example: <table class='iep-table'><thead><tr><th>Header</th></tr></thead><tbody><tr><td>Data</td></tr></tbody></table>
- Paragraphs: <p>text</p>
- NO <hr> tags (added automatically between sections)

### Section Emojis
- 👦 Student Information
- 🔍 Present Levels (PLAAFP)
- 📋 Disability Categories
- ⚠️ Areas of Concern
- 🎯 Priority Goal Areas
- 🏁 {{evaluation_schedule}} Goals (e.g., "🏁 Quarterly Goals")
- 🧰 Accommodations & Supports
- 📊 Progress Monitoring
- 🧑‍🏫 Participation in General Education Curriculum
- 👥 Special Education Services
- 🤝 Team Members

---

## SECTION INSTRUCTIONS

### 1. 👦 Student Information
- Format: List with emojis
- Include:
  - 👦 Student Name: [Student name]
  - 🏫 Grade Level: {{grade_level}}
  - 🗣️ Language: {{language}}
  - 📆 Evaluation Schedule: {{evaluation_schedule}}

### 2. 🔍 PLAAFP (Present Levels)
**CRITICAL:** EXPAND the brief teacher note into 3-4 comprehensive paragraphs WITH OBJECTIVE DATA

**MANDATORY REQUIREMENT: Include Baseline Data for EVERY Skill Area Mentioned**

For each academic/functional area discussed in PLAAFP, you MUST include specific measurable baseline data:

**Reading Baseline Data (if mentioned):**
- Fluency: "X words per minute with Y errors" OR "reads at Z grade level"
- Comprehension: "answers X% of literal/inferential questions correctly"
- Percentile/benchmark: "performs at Xth percentile for {{grade_level}}"
- Example: "Todd reads 85 words per minute with 5 errors at 2nd-grade level, placing him at the 5th percentile for 4th graders"

**Writing Baseline Data (if mentioned):**
- Organization: "completes X out of 5 sentences with coherence"
- Independence: "requires prompts on X% of writing tasks"
- Quality: "writes at X grade level" OR "scores Y on 4-point rubric"
- Example: "completes 2 out of 5 writing tasks with coherent organization, requiring prompts 80% of the time"

**Math Baseline Data (if mentioned):**
- Computation: "completes X out of 10 problems independently with Y% accuracy"
- Problem-solving: "solves X-step problems with Y% accuracy"
- Grade level: "performs at X grade level in math"
- Example: "solves single-step problems with 70% accuracy but struggles with multi-step problems (30% accuracy)"

**Functional/Behavioral Baseline Data (if attention/focus/organization mentioned):**
- Attention: "remains on task for X minutes before requiring redirection"
- Task completion: "completes assignments independently X% of the time"
- Organization: "organizes materials without prompts in X out of 5 opportunities"
- Behavior: "requires X prompts per hour to stay on task"
- Example: "remains on task for 8-10 minutes before needing redirection, requires 4-5 prompts per hour"

**NO VAGUE STATEMENTS ALLOWED:**
- ❌ BAD: "struggles with organization"
- ✅ GOOD: "requires prompts in 80% of tasks to organize materials, independently organizes in 1 out of 5 opportunities"
- ❌ BAD: "has difficulty with writing"
- ✅ GOOD: "writes at 2nd-grade level (2 grades below), completes 3 of 5 sentences with coherence"

**Paragraph Structure:**

**Paragraph 1 - Academic Performance:**
- Expand on reading/writing/math abilities with grade-level benchmarks
- MUST include measurable baseline data for EACH area mentioned (see examples above)
- Reference specific subjects appropriate for {{grade_level}}
- Use concrete numbers, percentages, grade levels, percentiles
- Compare to grade-level expectations

**Paragraph 2 - Functional Performance:**
- How challenges manifest daily in the classroom
- MUST include measurable data: time on task, prompts needed, completion rates
- Learning behaviors, attention span, task completion patterns with specific metrics
- Include frequency descriptors ("often", "80% of the time", "4 out of 5 days")

**Paragraph 3 - Strengths & Effective Strategies:**
- What works for this student
- Engagement triggers, successful interventions, conditions for success
- Include specific examples of when student performs best
- Reference accommodations that are already working

**Paragraph 4 - Impact on General Education:**
- How disability affects curriculum access
- Peer interactions, learning opportunities, support needs
- Specific subjects/activities where impact is most/least significant
- Level of support needed (independent, minimal, moderate, intensive)

**Language Requirements:**
- Use professional terms: "demonstrates", "exhibits", "requires", "benefits from"
- Include measurable data: percentages, grade levels, frequency descriptors, WPM, accuracy rates
- Be specific: Reference actual subjects and activities for the grade level
- Sound like a special education team who has observed the student for months

### 3. 📋 Disability Categories
- Simple bulleted list (<ul><li>)
- List each category from: {{disability_categories}}

### 4. ⚠️ Areas of Concern
- Simple bulleted list (<ul><li>)
- List each area from: {{areas_of_concern}}

### 5. 🎯 Priority Goal Areas
- Simple bulleted list (<ul><li>)
- List each area from: {{priority_goal_areas}}

### 6. 🏁 {{evaluation_schedule}} Goals
**CRITICAL:** Use SMART methodology for ALL goals and benchmarks

**MANDATORY COMPLETE COVERAGE RULE:**
- You MUST create a goal for EVERY academic/functional challenge mentioned in PLAAFP
- If PLAAFP mentions reading challenges → MUST create reading goal
- If PLAAFP mentions writing challenges → MUST create writing goal  
- If PLAAFP mentions math challenges → MUST create math goal
- If PLAAFP mentions attention/focus/organization → MUST create functional goal
- Do NOT skip any area of need mentioned in PLAAFP

**AUTO-DETECT FUNCTIONAL NEEDS:**
Even if not in {{priority_goal_areas}}, if PLAAFP mentions ANY of these, automatically create a corresponding goal:
- Attention/focus issues → Create "Attention & Focus" goal
- Organization problems → Create "Organization & Task Completion" goal
- Task completion challenges → Create "Task Completion" or "Self-Regulation" goal
- Behavioral concerns → Create "Self-Regulation & Behavior" goal

**SMART Criteria:**
- **S**pecific: Clearly defined, addressing EXACT challenges from PLAAFP (NOT vague like "improve reading")
- **M**easurable: Include concrete metrics (80% accuracy, 4 out of 5 trials, grade level)
- **A**chievable: Realistic given student's CURRENT level from PLAAFP
- **R**elevant: Directly addresses documented needs and areas of concern
- **T**ime-bound: Clear deadline matching {{evaluation_schedule}}

**Goal Structure:**
- Create ONE goal for EACH priority goal area in: {{priority_goal_areas}}
- PLUS additional goals for any needs mentioned in PLAAFP not covered above
- Format: "Goal 1: [Goal Area Name]"
- Each goal must have 3-4 short-term benchmarks

**Benchmark Requirements:**
- Each benchmark MUST follow SMART criteria
- Progressive difficulty: 60% → 70% → 75% → 80-90%
- Reference accommodations: {{accommodations}}
- Timeframes aligned with {{evaluation_schedule}}:
  - Annually: Fall semester → Winter break → Spring semester → End of year
  - Quarterly: Q1 → Q2 → Q3 → Q4
  - Weekly: Week 1-4 → Week 5-8 → Week 9-12 → Week 13-16
  - Bi-weekly: Weeks 1-2 → Weeks 3-4 → Weeks 5-6 → Weeks 7-8

**Example SMART Goals:**

*Academic Goal:*
"By the end of the school year, [Student name] will improve reading comprehension by accurately answering inferential and main idea questions in 6th-grade texts with 80% accuracy in 4 out of 5 opportunities, using graphic organizers."

*Functional Goal (if PLAAFP mentions attention):*
"By the end of Q4, [Student name] will independently remain on task during independent work for 15 minutes with no more than one prompt, in 4 out of 5 opportunities."

*Writing Goal (if PLAAFP mentions writing):*
"By the end of the school year, [Student name] will independently organize a 5-sentence paragraph with clear topic sentence, 3 supporting details, and conclusion, scoring 3 or higher on a 4-point rubric in 4 out of 5 writing tasks."

### 7. 🧰 Accommodations & Supports
**Format:** HTML table with class='iep-table'

**Structure:**
```html
<table class='iep-table'>
  <thead>
    <tr>
      <th>Category</th>
      <th>Accommodation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>📘 Reading</td>
      <td>[Specific accommodations]</td>
    </tr>
    <tr>
      <td>✍️ Writing</td>
      <td>[Specific accommodations]</td>
    </tr>
    <tr>
      <td>🧠 General</td>
      <td>[Specific accommodations]</td>
    </tr>
    <tr>
      <td>📝 Assessments</td>
      <td>[Specific accommodations]</td>
    </tr>
  </tbody>
</table>
```

**Personalization:**
- Base on specific PLAAFP challenges
- Reference selected accommodations: {{accommodations}}
- Be SPECIFIC and ACTIONABLE (not generic)
- Connect to student's learning style from performance data
- Ensure grade-appropriate for {{grade_level}}

### 8. 📊 Progress Monitoring
**Opening:** "Progress will be monitored {{evaluation_schedule}} through:"

**Requirements:**
- List SPECIFIC monitoring methods aligned with EACH goal created
- Include grade-appropriate assessment tools for {{grade_level}}
- Reference specific benchmarks (e.g., "Reading rubrics", "Writing samples on 4-point scale")
- Mention data collection methods matching accommodations
- Specify WHO monitors (teacher, aide, specialist)
- Connect to evaluation schedule: {{evaluation_schedule}}
- Include methods for ALL goals (academic AND functional)

**Example:**
- Reading comprehension rubrics focused on inferential questions
- Writing samples scored on 4-point organization scale
- Weekly self-regulation check-ins with behavior specialist
- On-task behavior tracking using 15-minute interval observations
- Math problem-solving probes administered bi-weekly
- Data collected by Special Education Teacher and reviewed {{evaluation_schedule}}

### 9. 🧑‍🏫 Participation in General Education Curriculum
**Requirements:**
- Describe specifically how THIS student participates in {{grade_level}} general education
- Reference accommodations/modifications needed for success
- Specify percentage of time (e.g., "70% in gen ed, 30% in resource room")
- Mention specific subjects where student excels vs. needs support
- Connect to areas of concern: {{areas_of_concern}}
- Describe pull-out services aligned with goals
- Be realistic about inclusion opportunities given needs

### 10. 👥 Special Education Services
**Format:** HTML table with class='iep-table' with 4 COLUMNS

**UPDATED Structure (4 columns):**
```html
<table class='iep-table'>
  <thead>
    <tr>
      <th>Service</th>
      <th>Frequency</th>
      <th>Location/Model</th>
      <th>Provider</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[Service name]</td>
      <td>[Frequency]</td>
      <td>[Delivery model & location]</td>
      <td>[Provider role]</td>
    </tr>
  </tbody>
</table>
```

**CRITICAL RULE:** Each service MUST DIRECTLY support at least one goal

**Service-to-Goal Mapping:**
- Reading Comprehension → Reading Intervention OR Literacy Support
- Written Expression → Writing Support OR Resource Room
- Math Problem Solving → Math Intervention
- Self-Regulation → Counseling OR Behavioral Support
- Social Skills → Social Skills Group OR Counseling
- Communication Development → Speech Therapy
- Attention & Focus → Behavioral Support OR Study Skills OR Executive Function Coaching
- Organization & Task Completion → Executive Function Coaching OR Study Skills

**Delivery Models (Location/Model column):**
- **Pull-out (Resource Room):** Student leaves general education classroom for specialized instruction in resource room
- **Push-in (General Ed Classroom):** Specialist comes into general education classroom to provide support
- **Co-Teaching:** Special education teacher co-teaches with general education teacher in classroom
- **Small Group (Resource Room):** Small group instruction in separate setting
- **Individual (Resource Room):** One-on-one instruction in separate setting

**Rules:**
- ONLY include services matching goals created (including auto-detected functional goals)
- DO NOT include unrelated services
- Example: No Speech Therapy if no communication/language goals
- Each service MUST specify delivery model AND location

**Frequency Levels:**
- **Intensive** (2+ grade levels behind): 3-5x per week, 30-45 minutes
- **Moderate** (specific skill deficits): 2-3x per week, 30 minutes
- **Maintenance** (monitoring/light support): 1x per week OR 2x per month, 30 minutes

**Naming:** Clearly show connection to goals (e.g., "Reading Comprehension Intervention" not "Special Ed Support")

**Example:**
| Service | Frequency | Location/Model | Provider |
|---------|-----------|----------------|----------|
| Reading Comprehension Intervention | 3x per week, 45 min | Pull-out (Resource Room) | Special Education Teacher |
| Executive Function Coaching | 2x per week, 30 min | Push-in (Gen Ed Classroom) | Special Education Teacher |

### 11. 🤝 Team Members
**Format:** Bulleted list with roles

**Required Roles:**
- General Education Teacher: [name]
- Special Education Teacher: [name]
- Parent/Guardian: [name]
- School Psychologist: [name]
- IEP Coordinator: [name]

**Note:** Use [name] placeholder, do NOT invent names

---

## COHERENCE REQUIREMENTS

**CRITICAL:** Ensure coherence across ALL sections

**Connections:**
- **PLAAFP → Goals:** Goals MUST directly address challenges described in PLAAFP. EVERY challenge in PLAAFP needs a goal.
- **Goals → Accommodations:** Accommodations MUST support the specific goals created
- **Goals → Services:** Services MUST align with intensity and type of goals (1:1 mapping)
- **Goals → Monitoring:** Progress monitoring MUST measure specific goal benchmarks
- **Overall:** Every section should reference and connect to student's documented needs

**Narrative:** The entire IEP should tell a cohesive story about THIS specific student

**COMPLIANCE CHECKLIST (verify before generating):**
✓ PLAAFP has measurable baseline data for every skill area mentioned
✓ Every challenge in PLAAFP has a corresponding goal
✓ All goals follow SMART criteria
✓ All services directly support at least one goal
✓ Services specify delivery model (pull-out, push-in, co-teaching) and location
✓ Progress monitoring methods exist for every goal
✓ Accommodations support the goals created
✓ Functional goals created if PLAAFP mentions attention/organization/behavior

---

## STYLE GUIDELINES

- **Student Name:** Use "[Student name]" placeholder (do NOT invent actual names)
- **Specificity:** Be specific and measurable in all goals and objectives
- **Tone:** Professional, encouraging language
- **Metrics:** Include concrete percentages and timeframes
- **Practicality:** Make accommodations practical and implementable
- **Consistency:** Ensure consistency with student's grade level and needs

---

## OUTPUT STRUCTURE

Generate a JSON object with this structure:

```json
{
  "sections": [
    {
      "title": "👦 Student Information",
      "content": "<HTML content here>"
    },
    {
      "title": "🔍 Present Levels of Academic Achievement and Functional Performance (PLAAFP)",
      "content": "<HTML content here>"
    }
    // ... other sections based on iepComponents
  ]
}
```

**Only generate sections specified in:** {{iep_components}}

Now generate the personalized IEP document following ALL instructions above.

───────────────────────────────────────────────────────────────────────────────
END OF USER MESSAGE - COPY UNTIL HERE
───────────────────────────────────────────────────────────────────────────────

═══════════════════════════════════════════════════════════════════════════════
⚙️ CONFIG - TAB: CONFIG
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│ 📋 CONFIG (JSON format - copy entire block below)                          │
└─────────────────────────────────────────────────────────────────────────────┘

{
  "model": "gpt-4o-2024-08-06",
  "temperature": 0.7,
  "max_tokens": 4000,
  "top_p": 1,
  "frequency_penalty": 0,
  "presence_penalty": 0,
  "response_format": {
    "type": "json_object"
  }
}

═══════════════════════════════════════════════════════════════════════════════
🔤 VARIABLES - TAB: VARIABLES
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│ 📝 ADD VARIABLES (create the 10 variables below):                          │
└─────────────────────────────────────────────────────────────────────────────┘

IMPORTANT: In Langfuse, add each variable individually by clicking 
"+ Add variable" 10 times (one for each variable below).

1️⃣ student_performance
   Type: string
   Description: Brief 1-paragraph description of student's current academic and functional performance from teacher

2️⃣ grade_level
   Type: string
   Description: Student's grade level (e.g., '4th Grade', '7th Grade')

3️⃣ language
   Type: string
   Description: Primary language for the IEP document
   Default: English

4️⃣ evaluation_schedule
   Type: string
   Description: Frequency of evaluation (Annually, Quarterly, Weekly, Bi-weekly)

5️⃣ disability_categories
   Type: string
   Description: Comma-separated list of disability categories

6️⃣ areas_of_concern
   Type: string
   Description: Comma-separated list of areas of concern (Academic, Behavioral, Social/Emotional, Functional)

7️⃣ priority_goal_areas
   Type: string
   Description: Comma-separated list of priority goal areas. Goals will be created for these PLUS any other areas mentioned in PLAAFP

8️⃣ existing_services
   Type: string
   Description: Comma-separated list of existing services (e.g., 'Special Education Teacher Support, Speech Therapy')

9️⃣ accommodations
   Type: string
   Description: Comma-separated list of accommodations (e.g., 'Extended time, Visual aids, Breaks')

🔟 iep_components
   Type: string
   Description: Comma-separated list of IEP sections to generate (student-info, plaafp, disability-categories, areas-concern, priority-goals, goals, accommodations-mods, progress, gen-ed, services, team)

═══════════════════════════════════════════════════════════════════════════════
📊 TEST EXAMPLE (TODD CASE - v3.1.1)
═══════════════════════════════════════════════════════════════════════════════

After creating the prompt in Langfuse, test with these values:

student_performance = "Todd, a fourth grader, currently reads 85 words per minute with 5 errors when given a first semester, second grade-level passage. According to district norms, Todd is reading at the 5th percentile for fourth graders in the fall."

grade_level = "4th Grade"

language = "English"

evaluation_schedule = "Quarterly"

disability_categories = "Specific Learning Disability (SLD)"

areas_of_concern = "Academic (reading)"

priority_goal_areas = "Reading Comprehension"

existing_services = "Special Education Teacher Support"

accommodations = "Extended time, Visual aids/graphic organizers"

iep_components = "student-info, plaafp, disability-categories, areas-concern, priority-goals, goals, accommodations-mods, progress, gen-ed, services, team"

═══════════════════════════════════════════════════════════════════════════════
🔍 EXPECTED BEHAVIOR v3.1.1 ULTRA-CONSERVATIVE (Todd Case):
═══════════════════════════════════════════════════════════════════════════════

With this example, system v3.1.1 MUST (ULTRA-CONSERVATIVE):

✅ PLAAFP with ONLY 3 paragraphs (academic, strengths, impact):
   Paragraph 1: "Todd reads at 85 words per minute with 5 errors, placing him at 
                 5th percentile. His reading fluency is below grade level."
   Paragraph 2: "Todd responds well to visual aids and graphic organizers."
   Paragraph 3: "Reading challenges affect access to reading-intensive subjects."
   
   ❌ NO "50% comprehension" (not provided)
   ❌ NO "8-10 minutes on task" (not mentioned)
   ❌ NO "40% independence" (not provided)
   ❌ NO Functional Performance paragraph (no trigger words)
   ❌ NO Writing (not mentioned in input)
   ❌ NO Math (not mentioned in input)

✅ Create ONLY 1 GOAL (conservative):
   1. Reading Comprehension (explicit in priorityGoalAreas)
   ❌ DO NOT create Writing goal (not mentioned)
   ❌ DO NOT create Math goal (not mentioned)
   ❌ DO NOT create Attention goal (not mentioned)

✅ AREAS OF CONCERN (LITERAL - v3.1.1):
   <li>Academic (reading)</li>
   ❌ NOT "Academic (e.g., reading, writing, math)" (expansion prohibited)

✅ ACCOMMODATIONS using ONLY selected list:
   Reading: Visual aids/graphic organizers, Extended time
   Assessments: Extended time, Visual aids
   ❌ NO "Frequent breaks" (not selected)
   ❌ NO "Modified assessments" (not selected)
   ❌ NO Writing category (not mentioned in PLAAFP)

✅ SERVICES aligned 1:1 with the 1 goal (table with 4 columns):
   - Reading Comprehension Intervention | 3x/week, 45min | Pull-out (Resource Room) | Sp Ed Teacher
   ❌ NO Writing Support
   ❌ NO Math Intervention
   ❌ NO Executive Function Coaching

✅ Progress Monitoring ONLY for Reading

✅ Participation mentions ONLY reading-intensive subjects
   "requires support in reading-intensive subjects such as language arts and content area reading"
   ❌ NO mention of "math" 
   ❌ NO mention of "writing"

═══════════════════════════════════════════════════════════════════════════════
✅ FINAL CHECKLIST v3.1.1
═══════════════════════════════════════════════════════════════════════════════

Before clicking "Create prompt" in Langfuse:

[ ] Name = "IEP/Generator"
[ ] "Chat" tab selected
[ ] System message v3.1.1 pasted (ULTRA-CONSERVATIVE - NO DATA INVENTION)
[ ] User message v3.1.1 complete pasted (~800 lines with 3 critical fixes)
[ ] Config JSON pasted (temperature: 0.7, max_tokens: 4000)
[ ] 10 variables created (studentPerformance to iepComponents)
[ ] Label "production" checked
[ ] Commit message: "v3.1.1 - ULTRA-CONSERVATIVE: no data invention, no functional paragraph without triggers, literal Areas of Concern"
[ ] Tested with Todd case and validated:
    [ ] PLAAFP without "50% comprehension", "8-10 min on-task", "40% independence"
    [ ] PLAAFP without functional paragraph (input had no trigger words)
    [ ] Areas of Concern = "Academic (reading)" (no expansion)
    [ ] 1 reading goal (no math/writing/attention)

═══════════════════════════════════════════════════════════════════════════════
📚 ADDITIONAL DOCUMENTATION
═══════════════════════════════════════════════════════════════════════════════

See files:
- IEP_GENERATOR_IMPROVEMENTS_V3.md → v3.0 improvements documentation
- IEP_V3.1.1_CRITICAL_FIXES.md → v3.1.1 critical fixes documentation
- IEP_VALIDATOR_USAGE.md → How to use validation tools
- LANGFUSE_IEP_PROMPT.json → Structured prompt version (v3.1.1 ULTRA-CONSERVATIVE)
- IEP_PROMPT_STRUCTURE.json → Detailed structure (pending update)

Validation Tools:
- /src/lib/iep-validator.ts → TypeScript validation library
- /src/app/validate-iep/page.tsx → Web UI for validation (http://localhost:3000/validate-iep)
- /scripts/validate-iep-v3.1.1.js → CLI validation script

═══════════════════════════════════════════════════════════════════════════════
⚖️ DIFFERENCES v3.0 vs v3.1 vs v3.1.1
═══════════════════════════════════════════════════════════════════════════════

v3.0 (PROACTIVE - ❌ Bugs):
❌ Inferred problems not mentioned
❌ Added "helpful" accommodations
❌ Created goals for areas not cited
❌ Mentioned math/writing even without input

v3.1 (CONSERVATIVE - ⚠️ Still had bugs):
✅ Expands ONLY what was said
✅ Uses ONLY selected accommodations
❌ BUT still invented data (50% comp., 8-10 min focus, 40% indep.)
❌ BUT still created functional paragraph without trigger words
❌ BUT still expanded Areas of Concern

v3.1.1 (ULTRA-CONSERVATIVE - ✅ All bugs fixed):
✅ Expands ONLY what was said
✅ Uses ONLY selected accommodations
✅ Uses ONLY provided data (ZERO invention)
✅ Functional paragraph ONLY with trigger words
✅ Areas of Concern literal (exact copy)

WHEN TO USE:
- v3.1.1: ALWAYS (most reliable version)
- v3.1.1: When input is minimalist (e.g. only reading)
- v3.1.1: When you want strict control over output
- v3.1.1: When you need IEP focused on 1-2 areas

PRACTICAL EXAMPLE (Todd Case):
Input: "Todd reads 85 WPM, 5 errors... 5th percentile"
      + Areas: "Academic (reading)"
      
- v3.0: 4 goals + invents data ❌
- v3.1: 1 goal but invents "50% comp., 8-10min focus" + expands Areas ❌
- v3.1.1: 1 goal, NO data invention, literal Areas ✅

═══════════════════════════════════════════════════════════════════════════════
